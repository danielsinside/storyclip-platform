{
  "title": "StoryClip – SLOs",
  "uid": "storyclip-slos",
  "schemaVersion": 36,
  "version": 1,
  "time": { "from": "now-6h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "Queue Depth",
      "targets": [{ "expr": "storyclip_queue_depth" }],
      "gridPos": { "h": 6, "w": 5, "x": 0, "y": 0 }
    },
    {
      "type": "stat",
      "title": "SVT-AV1 disponible",
      "targets": [{ "expr": "avg_over_time(storyclip_svt_av1_available[5m])" }],
      "gridPos": { "h": 6, "w": 5, "x": 5, "y": 0 }
    },
    {
      "type": "stat",
      "title": "Error Budget Remaining (SLO 99.5%)",
      "targets": [
        { "expr": "clamp_min(1 - ( (rate(storyclip_jobs_failed_total[1h])) / (rate(storyclip_jobs_created_total[1h])+1e-9) ) / 0.005, 0)" }
      ],
      "gridPos": { "h": 6, "w": 6, "x": 10, "y": 0 }
    },
    {
      "type": "timeSeries",
      "title": "Error Ratio (5m vs 1h)",
      "targets": [
        { "expr": "(rate(storyclip_jobs_failed_total[5m]))/(rate(storyclip_jobs_created_total[5m])+1e-9)", "legendFormat": "5m" },
        { "expr": "(rate(storyclip_jobs_failed_total[1h]))/(rate(storyclip_jobs_created_total[1h])+1e-9)", "legendFormat": "1h" }
      ],
      "gridPos": { "h": 8, "w": 10, "x": 0, "y": 6 }
    },
    {
      "type": "timeSeries",
      "title": "Burn Rate (5m / 1h)",
      "targets": [
        { "expr": "((rate(storyclip_jobs_failed_total[5m]))/(rate(storyclip_jobs_created_total[5m])+1e-9)) / 0.005", "legendFormat": "5m" },
        { "expr": "((rate(storyclip_jobs_failed_total[1h]))/(rate(storyclip_jobs_created_total[1h])+1e-9)) / 0.005", "legendFormat": "1h" }
      ],
      "gridPos": { "h": 8, "w": 14, "x": 10, "y": 6 }
    },
    {
      "type": "timeSeries",
      "title": "P90 Duración por preset (s)",
      "targets": [
        { "expr": "histogram_quantile(0.9, sum(rate(storyclip_job_duration_seconds_bucket[5m])) by (le,preset))", "legendFormat": "{{preset}}" }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 }
    },
    {
      "type": "timeSeries",
      "title": "Throughput (jobs completados /s)",
      "targets": [
        { "expr": "rate(storyclip_jobs_completed_total[5m])", "legendFormat": "completed" }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 }
    }
  ]
}
